Deepakkumar@MacBookAir backend % npm test -- --verbose > test-report.txt

FAIL src/tests/restockSweet.test.js
  ✕ Admin should restock a sweet successfully (1 ms)
  ✕ Non-admin should not restock

  ● Admin should restock a sweet successfully

    ValidationError: User validation failed: password: Path `password` is required., username: Path `username` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

  ● Non-admin should not restock

    ValidationError: User validation failed: password: Path `password` is required., username: Path `username` is required.

      at model.Document.invalidate (node_modules/mongoose/lib/document.js:3362:32)
      at node_modules/mongoose/lib/document.js:3123:17
      at node_modules/mongoose/lib/schemaType.js:1420:9

FAIL src/tests/sweetUpdate.test.js
  ✕ Update sweet details using PUT /api/sweets/:id (110 ms)

  ● Update sweet details using PUT /api/sweets/:id

    expect(received).toBe(expected) // Object.is equality

    Expected: 200
    Received: 401

      33 |   });
      34 |
    > 35 |   expect(res.statusCode).toBe(200);
         |                          ^
      36 |   expect(res.body.price).toBe(150);
      37 |   expect(res.body.quantity).toBe(40);
      38 | });

      at Object.toBe (src/tests/sweetUpdate.test.js:35:26)

PASS src/tests/sweetSearch.test.js
  Search Sweets API
    ✓ Search by name (141 ms)
    ✓ Search by category (81 ms)
    ✓ Search by price range (80 ms)
    ✓ Search by name + category + price (79 ms)

PASS src/tests/sweetPurchase.test.js
  ✓ purchase sweet should decrease quantity by 1 (256 ms)
  ✓ should return 400 if sweet is out of stock (181 ms)

PASS src/tests/auth.test.js
  ✓ POST /register → should register a user successfully (1485 ms)
  ✓ POST /register → should fail if user already exists (223 ms)
  ✓ POST /login → should login user successfully (222 ms)
  ✓ POST /login → should fail on invalid credentials (153 ms)

PASS src/tests/sweet.test.js
  ✓ Admin can create a new sweet (78 ms)

PASS src/tests/sweetList.test.js
  ✓ GET /api/sweets should list all sweets (787 ms)

PASS src/tests/sweetDelete.test.js
  ✓ Admin should delete a sweet successfully (886 ms)
  ✓ Non-admin user should NOT delete a sweet (86 ms)

PASS src/tests/authMiddleware.test.js
  ✓ Should block access when no token is provided (11 ms)
  ✓ Should allow access when a valid token is provided (9 ms)

PASS src/tests/db.test.js
  ✓ Database should connect successfully (963 ms)

Test Suites: 2 failed, 8 passed, 10 total
Tests:       3 failed, 17 passed, 20 total
Snapshots:   0 total
Time:        23.547 s, estimated 33 s
Ran all test suites.
Deepakkumar@MacBookAir backend % 